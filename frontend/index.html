<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Options Scanner</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/v2/style.css">
</head>

<body>

  <!-- APP SHELL -->
  <div id="app-shell">

    <!-- App Header -->
    <header class="app-header">
      <div class="app-header-left">üìà Options Scanner</div>
      <div class="app-header-right">
        <span class="hdr-stat">Watchlist: <b id="watchlist-count">0</b></span>
        <span class="hdr-stat">Opportunities: <b id="opportunities-count">0</b></span>
        <span class="hdr-stat">Open Trades: <b id="open-trades-count">0</b></span>
        <span class="hdr-stat">Heat: <b id="heat-value">‚Äî</b></span>
        <span class="hdr-stat" id="username-display" style="font-weight:600; display:none;">üë§</span>
        <button class="hdr-theme-toggle" id="theme-toggle" title="Toggle dark/light mode">‚òÄÔ∏è</button>
        <span class="hdr-stat hdr-logout" id="logout-btn">Logout</span>
      </div>
    </header>

    <!-- App Tabs -->
    <nav class="app-tabs">
      <span class="app-tab active" data-tab="scanner">Scanner</span>
      <span class="app-tab" data-tab="portfolio">Portfolio</span>
      <span class="app-tab" data-tab="risk">Risk</span>
    </nav>

    <!-- Scanner Tab Content -->
    <div id="tab-scanner" class="tab-content active">
      <div class="scanner-body">

        <!-- Left Sidebar / Control Panel -->
        <aside class="control-panel">

          <!-- 1. Scan Control -->
          <div class="ctrl-box">
            <div class="ctrl-box-title">Scan Control</div>
            <div class="ctrl-btn-row">
              <button class="ctrl-btn mode-btn" id="mode-0dte" data-mode="0dte">‚ö° 0DTE</button>
              <button class="ctrl-btn mode-btn" id="mode-weekly-0" data-mode="weekly-0">This Week</button>
              <button class="ctrl-btn mode-btn" id="mode-weekly-1" data-mode="weekly-1">Next Week</button>
            </div>
            <div class="ctrl-btn-row">
              <button class="ctrl-btn mode-btn" id="mode-weekly-2" data-mode="weekly-2">Next 2 Weeks</button>
              <button class="ctrl-btn mode-btn" id="mode-leaps" data-mode="leaps">Leaps</button>
            </div>
          </div>

          <!-- 2. Smart Search -->
          <div class="ctrl-box">
            <div class="ctrl-box-title">Smart Search</div>
            <div class="ctrl-input-stacked" style="position:relative;">
              <input type="text" id="quick-scan-input" class="ctrl-input full-width"
                placeholder="Enter ticker symbol..." autocomplete="off" spellcheck="false">
              <div id="autocomplete-list" class="autocomplete-dropdown" style="display:none;"></div>
              <button class="ctrl-btn scan-btn full-width" id="btn-scan-ticker">üîç Scan Ticker</button>
            </div>
          </div>

          <!-- 3. Sector Scan -->
          <div class="ctrl-box">
            <div class="ctrl-box-title">Sector Scan</div>
            <select class="ctrl-select" id="sector-select">
              <option value="">Select sector...</option>
              <option value="Technology">Technology</option>
              <option value="Financial Services">Financial Services</option>
              <option value="Healthcare">Healthcare</option>
              <option value="Consumer Cyclical">Consumer Cyclical</option>
              <option value="Consumer Defensive">Consumer Defensive</option>
              <option value="Energy">Energy</option>
              <option value="Industrials">Industrials</option>
              <option value="Communication Services">Communication Services</option>
              <option value="Basic Materials">Basic Materials</option>
              <option value="Real Estate">Real Estate</option>
              <option value="Utilities">Utilities</option>
            </select>
            <!-- Progressive disclosure ‚Äî shown after sector selection -->
            <div id="sector-extra-filters" style="display:none; flex-direction:column; gap:6px; margin-top:6px;">
              <select class="ctrl-select" id="industry-select">
                <option value="">Any Subsector</option>
              </select>
              <select class="ctrl-select" id="vol-select">
                <option value="">Any Volume</option>
                <option value="500000">Volume: Medium (&gt;500K)</option>
                <option value="1000000">Volume: High (&gt;1M)</option>
                <option value="5000000">Volume: Very High (&gt;5M)</option>
              </select>
              <select class="ctrl-select" id="cap-select">
                <option value="">Any Market Cap</option>
                <option value="2000000000">Mid Cap (&gt;$2B)</option>
                <option value="10000000000">Large Cap (&gt;$10B)</option>
                <option value="100000000000">Mega Cap (&gt;$100B)</option>
              </select>
              <button class="ctrl-btn scan-btn full-width" id="btn-sector-scan">üîç Scan Sector</button>
            </div>
          </div>

          <!-- 4. Recent History -->
          <div class="ctrl-box">
            <div class="ctrl-box-title">Recent History</div>
            <div id="recent-history-list">
              <div class="ctrl-placeholder">No recent scans</div>
            </div>
          </div>

        </aside>

        <!-- Main Area -->
        <main class="main-area">

          <!-- Scan Progress Bar -->
          <div id="scan-progress" class="scan-progress hidden">
            <div class="scan-progress-bar"></div>
            <span class="scan-progress-text">Scanning...</span>
          </div>

          <!-- Watchlist Row -->
          <div class="watchlist-row">
            <div class="watchlist-add" style="position:relative;">
              <input type="text" id="watchlist-input" class="ctrl-input" placeholder="Add to Watchlist..."
                autocomplete="off" spellcheck="false">
              <div id="watchlist-autocomplete" class="autocomplete-dropdown" style="display:none;"></div>
            </div>
            <div class="watchlist-label">My Watchlist</div>
            <div class="watchlist-chips" id="watchlist-chips">
              <!-- Chips rendered by JS -->
            </div>
          </div>

          <!-- Opportunities Header -->
          <div class="opportunities-header">
            <div class="opp-title">
              Opportunities <span class="opp-mode-label" id="opportunities-mode-label">This Week</span>
            </div>
            <div class="opp-filters">
              <span class="filter-pill btn-filter active" data-value="15">&gt;15%</span>
              <span class="filter-pill btn-filter" data-value="25">&gt;25%</span>
              <span class="filter-pill btn-filter" data-value="35">&gt;35%</span>
              <select class="ctrl-select sm" id="ticker-filter">
                <option value="all">All Tickers</option>
              </select>
              <select class="ctrl-select sm" id="sort-select">
                <option value="score">Sort: Score</option>
                <option value="profit">Sort: Profit</option>
                <option value="expiry">Sort: Expiry</option>
              </select>
            </div>
          </div>

          <!-- Opportunities Container -->
          <div id="opportunities-container">
            <div class="empty-state">
              <div class="empty-icon">üîç</div>
              <div class="empty-text">No active scan results. Run a scan to discover opportunities.</div>
            </div>
          </div>

        </main>
      </div>
    </div>

    <!-- Portfolio Tab Content -->
    <div id="tab-portfolio" class="tab-content">

      <!-- Sub-Tabs -->
      <div class="portfolio-sub-tabs" id="portfolioSubTabs">
        <button class="sub-tab active" data-sub="open-positions">Open Positions</button>
        <button class="sub-tab" data-sub="trade-history">Trade History</button>
        <button class="sub-tab" data-sub="performance">Performance</button>
        <button class="sub-tab" data-sub="settings">Settings</button>
      </div>

      <!-- Mobile: Sub-tab dropdown -->
      <div class="mobile-sub-select-wrapper" id="mobileSubSelect">
        <select class="mobile-sub-select" id="mobileSubDropdown">
          <option value="open-positions" selected>Open Positions</option>
          <option value="trade-history">Trade History</option>
          <option value="performance">Performance</option>
          <option value="settings">Settings</option>
        </select>
      </div>

      <!-- Mode Banner -->
      <div class="mode-banner">üü¢ SANDBOX MODE ‚Äî Paper trading active</div>

      <!-- SUB-VIEW 1: OPEN POSITIONS -->
      <div class="sub-panel active" id="sub-open-positions">
        <div class="content-area">
          <div class="port-stat-cards" id="stat-cards">
            <div class="port-stat-card">
              <div class="port-stat-label">Portfolio Value</div>
              <div class="port-stat-value">Loading...</div>
            </div>
            <div class="port-stat-card">
              <div class="port-stat-label">Today's P&L</div>
              <div class="port-stat-value">‚Äî</div>
            </div>
            <div class="port-stat-card">
              <div class="port-stat-label">Open Positions</div>
              <div class="port-stat-value">‚Äî</div>
            </div>
            <div class="port-stat-card">
              <div class="port-stat-label">Cash Available</div>
              <div class="port-stat-value">‚Äî</div>
            </div>
          </div>
          <div class="port-table-wrapper">
            <table class="port-table">
              <thead>
                <tr>
                  <th>Ticker</th>
                  <th>Type</th>
                  <th>Strike</th>
                  <th>Entry</th>
                  <th>Current</th>
                  <th>P&L</th>
                  <th>SL / TP</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="positions-table-body">
                <tr>
                  <td colspan="9" style="text-align:center;padding:32px;">Loading positions...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- SUB-VIEW 2: TRADE HISTORY -->
      <div class="sub-panel" id="sub-trade-history">
        <div class="content-area">
          <div class="port-summary-bar" id="history-summary">
            <div class="port-summary-box">
              <div class="port-sum-label">Total Closed</div>
              <div class="port-sum-value">‚Äî</div>
            </div>
            <div class="port-summary-box">
              <div class="port-sum-label">Win Rate</div>
              <div class="port-sum-value">‚Äî</div>
            </div>
            <div class="port-summary-box">
              <div class="port-sum-label">Realized P&L</div>
              <div class="port-sum-value">‚Äî</div>
            </div>
          </div>
          <div class="port-filter-row" id="history-filters">
            <button class="port-pill-filter active">All</button>
            <button class="port-pill-filter">Wins</button>
            <button class="port-pill-filter">Losses</button>
            <button class="port-pill-filter">Expired</button>
            <button class="port-pill-filter">SL Hit</button>
            <button class="port-pill-filter">TP Hit</button>
            <span style="margin-left:auto;"></span>
            <select id="history-ticker-filter" class="port-filter-select">
              <option value="ALL">All Tickers</option>
            </select>
          </div>
          <div class="port-filter-row" style="gap:8px;margin-top:4px;">
            <label style="font-size:0.72rem;color:var(--text-muted);font-weight:600;">From</label>
            <input type="date" id="history-date-start" class="port-filter-date">
            <label style="font-size:0.72rem;color:var(--text-muted);font-weight:600;">To</label>
            <input type="date" id="history-date-end" class="port-filter-date">
            <button class="port-btn port-btn-sm" id="history-reset-filters" style="margin-left:auto;">‚Ü∫ Reset</button>
          </div>
          <div class="port-table-wrapper">
            <table class="port-table">
              <thead>
                <tr>
                  <th>Ticker</th>
                  <th>Type</th>
                  <th>Entry ‚Üí Exit</th>
                  <th>P&L</th>
                  <th>Held</th>
                  <th>Reason</th>
                  <th>Date</th>
                </tr>
              </thead>
              <tbody id="history-table-body">
                <tr>
                  <td colspan="7" style="text-align:center;padding:32px;">Click the Trade History tab to load data.</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="port-export-row">
            <button class="port-btn btn-export-csv">üì• Export CSV</button>
            <button class="port-btn btn-export-json">üì• Export JSON</button>
          </div>
        </div>
      </div>

      <!-- SUB-VIEW 3: PERFORMANCE -->
      <div class="sub-panel" id="sub-performance">
        <div class="content-area">
          <div class="port-filter-row" id="perf-period-filters" style="margin-bottom:12px;">
            <button class="port-pill-filter">30D</button>
            <button class="port-pill-filter">YTD</button>
            <button class="port-pill-filter active">All</button>
            <button class="port-pill-filter">Custom</button>
          </div>
          <div id="perf-custom-range" style="display:none;gap:8px;align-items:center;margin-bottom:12px;">
            <label style="font-size:0.72rem;color:var(--text-muted);font-weight:600;">From</label>
            <input type="date" id="perf-custom-start" class="port-filter-date">
            <label style="font-size:0.72rem;color:var(--text-muted);font-weight:600;">To</label>
            <input type="date" id="perf-custom-end" class="port-filter-date">
          </div>
          <div class="port-kpi-cards" id="perf-kpi-cards">
            <div style="text-align:center;padding:24px;">Click the Performance tab to load analytics.</div>
          </div>
          <div class="port-charts-grid" id="perf-charts-grid"></div>
          <div class="port-breakdown-grid" id="perf-breakdown-grid"></div>
          <div class="port-export-row">
            <button class="port-btn btn-export-csv">üì• Export CSV</button>
            <button class="port-btn btn-export-json">üì• Export JSON</button>
          </div>
        </div>
      </div>

      <!-- SUB-VIEW 4: SETTINGS -->
      <div class="sub-panel" id="sub-settings">
        <div class="content-area">
          <div class="port-settings-grid" id="settings-grid">
            <div style="text-align:center;padding:24px;">Loading settings...</div>
          </div>
        </div>
      </div>

    </div><!-- /tab-portfolio -->

    <!-- Risk Tab (placeholder) -->
    <div id="tab-risk" class="tab-content">
      <div class="coming-soon-state">
        <div class="empty-icon">üõ°Ô∏è</div>
        <div class="empty-text">Risk management ‚Äî coming soon</div>
      </div>
    </div>

  </div>

  <!-- Analyze Detail View (hidden, populated by JS) -->
  <div id="analyze-view" class="overlay-view" style="display:none;"></div>

  <!-- AI Analysis Result View (hidden, populated by JS) -->
  <div id="ai-result-view" class="overlay-view" style="display:none;"></div>

  <!-- Trade Modal Overlay -->
  <div id="trade-modal-overlay" class="modal-overlay" style="display:none;">
    <div id="trade-modal" class="modal-content"></div>
  </div>

  <!-- Trade Result Overlay (success/failure) -->
  <div id="trade-result-overlay" class="modal-overlay" style="display:none;">
    <div id="trade-result-modal" class="modal-content"></div>
  </div>

  <!-- Toast Container -->
  <div id="toast-container" class="toast-container"></div>

  <script src="/v2/app.js"></script>
  <script src="/v2/portfolio.js"></script>
</body>

</html>